       1                                	.title	CPU
       2                                	.enabl	LC
       3                                	.asect
       4 002000                         	.=2000
       5                                
       6 004000                         C_RAM_BANKS11 = ^B0000100000000000
       7 006000                         C_RAM_BANKS14 = ^B0000110000000000
       8 004400                         C_RAM_BANKS15 = ^B0000100100000000
       9 007400                         C_RAM_BANKS16 = ^B0000111100000000
      10 044400                         C_RAM_BANKS45 = ^B0100100100000000
      11 007400                         C_RAM_BANKS16 = ^B0000111100000000
      12 017400                         C_RAM_BANKS56 = ^B0001111100000000
      13                                
      14 000006                         C_RAM_0 = ^B110
      15 000000                         C_RAM_1 = ^B000
      16 000002                         C_RAM_2 = ^B010
      17 000003                         C_RAM_3 = ^B011
      18 000004                         C_RAM_4 = ^B100
      19 000001                         C_RAM_5 = ^B001
      20 000007                         C_RAM_6 = ^B111
      21 000005                         C_RAM_7 = ^B101
      22                                
      23 000061                         C_KEY_1		= 61
      24 000062                         C_KEY_2		= 62
      25 000063                         C_KEY_3		= 63
      26 000064                         C_KEY_4		= 64
      27 000032                         C_KEY_UP	= 32
      28 000033                         C_KEY_DOWN	= 33
      29 000010                         C_KEY_LEFT	= 10
      30 000031                         C_KEY_RIGHT	= 31
      31 000040                         C_KEY_SPACE	= 40
      32                                
      33 100000                         C_VADDR  = 100000
      34 000100                         C_SCRWID = 64.
      35                                
      36 002000 106427  000200          Start:	mtps	#200
      37 002004 012706  001000          	mov	#1000, SP
      38 002010 010637  000004          	mov	SP, @#4
      39                                
      40 002014 012737  004400  177716  	mov	#C_RAM_BANKS15, @#177716
      41 002022 005037  177662          	clr	@#177662
      42 002026 012737  001330  177664  	mov	#1330, @#177664
      43                                
      44 002034 012700  100000          	mov	#100000, R0
      45 002040 012703  020000          	mov	#20000, R3
      46 002044 005020                  	clr	(R0)+
      47 002046 077302                  	sob	R3, .-2
      48                                
      49 002050 012737  002202  000060  	mov	#KbdInt, @#60
      50 002056 005037  000062          	clr	@#62
      51 002062 012737  002204  000274  	mov	#Kbd274, @#274
      52 002070 042737  000100  177660  	bic	#^B01000000, @#177660
      53                                
      54 002076 012737  002120  000100  	mov	#VsyInt, @#100
      55 002104 005037  000102          	clr	@#102
      56                                
      57 002110 106427  000000          	mtps	#0
      58 002114 000167  002552'         	jmp	Speed
      59                                
      60 002120 005267  002550'         VsyInt:	inc	Tick50
      61 002124 026727  002550' 000764  	cmp	Tick50, #500.
      62 002132 103422                  	blo	99$
      63 002134 010046                  	mov	R0, -(SP)
      64 002136 010146                  	mov	R1, -(SP)
      65 002140 010246                  	mov	R2, -(SP)
      66 002142 010546                  	mov	R5, -(SP)
      67 002144 016700  002544'         	mov	Frames, R0
      68 002150 004767  002452'         	call	Digi3
      69 002154 004767  002344'         	call	Prist8
      70 002160 005067  002550'         	clr	Tick50
      71 002164 005067  002544'         	clr	Frames
      72 002170 012605                  	mov	(SP)+, R5
      73 002172 012602                  	mov	(SP)+, R2
      74 002174 012601                  	mov	(SP)+, R1
      75 002176 012600                  	mov	(SP)+, R0
      76 002200 000002                  99$:	rti
      77                                
      78 002202 000002                  KbdInt:	rti
      79 002204 000002                  Kbd274:	rti
      80                                
      81 002206    060     060     072  MsgFp8:	.asciz	"00:0"
         002211    060     000          
      82 002213    000                  	.even
      83                                
      84                                SprNumbers45:
      85 002214    077     063     063  	.byte	^B00111111, ^B00110011, ^B00110011, ^B00110011, ^B00111111, 0, 0, 0
         002217    063     077     000  
         002222    000     000          
      86 002224    014     014     014  	.byte	^B00001100, ^B00001100, ^B00001100, ^B00001100, ^B00001100, 0, 0, 0
         002227    014     014     000  
         002232    000     000          
      87 002234    077     060     077  	.byte	^B00111111, ^B00110000, ^B00111111, ^B00000011, ^B00111111, 0, 0, 0
         002237    003     077     000  
         002242    000     000          
      88 002244    077     060     074  	.byte	^B00111111, ^B00110000, ^B00111100, ^B00110000, ^B00111111, 0, 0, 0
         002247    060     077     000  
         002252    000     000          
      89 002254    063     063     077  	.byte	^B00110011, ^B00110011, ^B00111111, ^B00110000, ^B00110000, 0, 0, 0
         002257    060     060     000  
         002262    000     000          
      90 002264    077     003     077  	.byte	^B00111111, ^B00000011, ^B00111111, ^B00110000, ^B00111111, 0, 0, 0
         002267    060     077     000  
         002272    000     000          
      91 002274    077     003     077  	.byte	^B00111111, ^B00000011, ^B00111111, ^B00110011, ^B00111111, 0, 0, 0
         002277    063     077     000  
         002302    000     000          
      92 002304    077     060     060  	.byte	^B00111111, ^B00110000, ^B00110000, ^B00110000, ^B00110000, 0, 0, 0
         002307    060     060     000  
         002312    000     000          
      93 002314    077     063     077  	.byte	^B00111111, ^B00110011, ^B00111111, ^B00110011, ^B00111111, 0, 0, 0
         002317    063     077     000  
         002322    000     000          
      94 002324    077     063     077  	.byte	^B00111111, ^B00110011, ^B00111111, ^B00110000, ^B00111111, 0, 0, 0
         002327    060     077     000  
         002332    000     000          
      95 002334    000     000     000  	.byte	^B00000000, ^B00000000, ^B00000000, ^B00000000, ^B00001100, 0, 0, 0
         002337    000     014     000  
         002342    000     000          
      96                                	.even
      97                                
      98 002344 012700  002206          PriSt8:	mov	#MsgFp8, R0
      99 002350 012705  100100          	mov	#1*C_SCRWID+C_VADDR, R5
     100 002354 012702  000100          	mov	#64., R2
     101 002360 112001                  10$:	movb	(R0)+, R1
     102 002362 001432                  	beq	99$
     103 002364 162701  000060          	sub	#'0, R1
     104 002370 006301                  	asl	R1
     105 002372 006301                  	asl	R1
     106 002374 006301                  	asl	R1
     107 002376 062701  002214          	add	#SprNumbers45, R1
     108                                	.rept	8.
     109                                	movb	(R1)+, (R5)
     110                                	add	R2, R5
     111                                	.endr
       1 002402 112115                  	movb	(R1)+, (R5)
       2 002404 060205                  	add	R2, R5
       1 002406 112115                  	movb	(R1)+, (R5)
       2 002410 060205                  	add	R2, R5
       1 002412 112115                  	movb	(R1)+, (R5)
       2 002414 060205                  	add	R2, R5
       1 002416 112115                  	movb	(R1)+, (R5)
       2 002420 060205                  	add	R2, R5
       1 002422 112115                  	movb	(R1)+, (R5)
       2 002424 060205                  	add	R2, R5
       1 002426 112115                  	movb	(R1)+, (R5)
       2 002430 060205                  	add	R2, R5
       1 002432 112115                  	movb	(R1)+, (R5)
       2 002434 060205                  	add	R2, R5
       1 002436 112115                  	movb	(R1)+, (R5)
       2 002440 060205                  	add	R2, R5
     112 002442 162705  000777          	sub	#8.*C_SCRWID-1, R5
     113 002446 000744                  	br	10$
     114 002450 000207                  99$:	return
     115                                
     116 002452 012705  002206          Digi3:	mov	#MsgFp8, R5
     117 002456 020027  001747          	cmp	R0, #999.
     118 002462 101402                  	blos	10$
     119 002464 012700  001747          	mov	#999., R0
     120 002470 012702  000144          10$:	mov	#100., R2
     121 002474 004767  002522'         	call	100$
     122 002500 012702  000012          	mov	#10., R2
     123 002504 004767  002522'         	call	100$
     124 002510 005205                  	inc	R5
     125 002512 062700  000060          	add	#'0, R0
     126 002516 110015                  	movb	R0, (R5)
     127 002520 000207                  	return
     128 002522 012701  000060          100$:	mov	#'0, R1
     129 002526 020002                  110$:	cmp	R0, R2
     130 002530 103403                  	blo	120$
     131 002532 160200                  	sub	R2, R0
     132 002534 005201                  	inc	R1
     133 002536 000773                  	br	110$
     134 002540 110125                  120$:	movb	R1, (R5)+
     135 002542 000207                  	return
     136                                
     137 002544 000000                  Frames:		.word	0
     138 002546 000000                  Lines:		.word	0
     139 002550 000000                  Tick50:		.word	0
     140                                
     141 000100                         TablSize	= 64.
     142 000020                         Angle		= 16.
     143 002566                         Variable	= Accums+6
     144                                
     145 002552 000402                  Speed:	br	Begin
     146 002554 036543  001321          	.WORD	36543, 1321
     147                                Accums:
     148                                
     149                                Begin:
     150 002560 012701  003166          	MOV	#Tabl+32., R1
     151 002564 012702  000040          	MOV	#32., R2
     152 002570 116221  003125          10$:	MOVB	Tabl-1(R2), (R1)+
     153 002574 077203                  	SOB	R2, 10$
     154                                
     155 002576 005067  002546'         Loop:	clr	Lines
     156 002602 012703  002560          	MOV	#Accums, R3
     157 002606 005023                  	CLR	(R3)+
     158 002610 005023                  	CLR	(R3)+
     159 002612 005723                  	TST	(R3)+
     160 002614 012700  000100          	MOV	#100, R0
     161 002620 105213                  Direct:	INCB	(R3)
     162 002622 001002                  	BNE	10$
     163 002624 074067  002620'         	XOR	R0, Direct
     164 002630 012313                  10$:	MOV	(R3)+, (R3)
     165 002632 012313                  	MOV	(R3)+, (R3)
     166 002634 012700  100100          	MOV	#C_SCRWID+C_VADDR, R0
     167                                
     168 002640 012704  002552          Render:	MOV	#Speed, R4
     169 002644 012703  000003          	MOV	#3, R3
     170 002650 062464  000004          10$:	ADD	(R4)+, 4(R4)
     171 002654 005564  000014          	ADC	14(R4)
     172 002660 077305                  	SOB	R3, 10$
     173                                
     174 002662 012703  002574          	MOV	#Variable+6, R3
     175 002666 011304                  	MOV	(R3), R4
     176 002670 004767  003106'         	CALL	Sin
     177 002674 000305                  	SWAB	R5
     178 002676 006305                  	ASL	R5
     179 002700 010567  002552'         	MOV	R5, Speed
     180                                
     181 002704 014304                  	MOV	-(R3), R4
     182 002706 004767  003106'         	CALL	Sin
     183 002712 062705  000040          	ADD	#32., R5
     184 002716 006205                  	ASR	R5
     185 002720 006205                  	ASR	R5
     186 002722 010502                  	MOV	R5, R2
     187                                
     188 002724 014304                  	MOV	-(R3), R4
     189                                
     190 002726 010046                  	MOV	R0, -(SP)
     191 002730 010046                  	MOV	R0, -(SP)
     192 002732 062716  000077          	ADD	#77, (SP)
     193 002736 012703  000004          	MOV	#4, R3
     194 002742 004767  003106'         30$:	CALL	Sin
     195 002746 010501                  	MOV	R5, R1
     196 002750 006201                  	ASR	R1
     197 002752 062704  000020          	ADD	#Angle, R4
     198 002756 004767  003106'         	CALL	Sin
     199 002762 006205                  	ASR	R5
     200 002764 160105                  	SUB	R1, R5
     201 002766 003422                  	BLE	70$
     202 002770 042700  000077          	BIC	#77, R0
     203 002774 060200                  	ADD	R2, R0
     204 002776 060100                  	ADD	R1, R0
     205 003000 020016                  	CMP	R0, (SP)
     206 003002 003001                  	BGT	40$
     207 003004 010016                  	MOV	R0, (SP)
     208 003006 116301  003121          40$:	MOVB	Color-1(R3), R1
     209 003012 110120                  50$:	MOVB	R1, (R0)+
     210 003014 077502                  	SOB	R5, 50$
     211 003016 020066  000002          	CMP	R0, 2(SP)
     212 003022 101402                  	BLOS	60$
     213 003024 010066  000002          	MOV	R0, 2(SP)
     214 003030 142740  000340          60$:	BICB	#340, -(R0)
     215 003034 077336                  70$:	SOB	R3, 30$
     216 003036 012605                  	MOV	(SP)+, R5
     217 003040 110345                  	MOVB	R3, -(R5)
     218 003042 110345                  	MOVB	R3, -(R5)
     219 003044 110345                  	MOVB	R3, -(R5)
     220 003046 110345                  	MOVB	R3, -(R5)
     221 003050 012605                  	MOV	(SP)+, R5
     222 003052 110325                  	MOVB	R3, (R5)+
     223 003054 110325                  	MOVB	R3, (R5)+
     224 003056 010315                  	MOV	R3, (R5)
     225                                
     226 003060 062700  000400          	ADD	#4*C_SCRWID, R0
     227 003064 005267  002546'         	inc	Lines
     228 003070 026727  002546' 000100  	cmp	Lines, #64.
     229 003076 103660                  	blo	Render
     230                                
     231 003100 005267  002544'         	inc	Frames
     232 003104 000634                  	br	Loop
     233                                
     234 003106 010405                  Sin:	MOV	R4, R5
     235 003110 042705  177700          	BIC	#177700, R5
     236 003114 116505  003126          	MOVB	Tabl(R5), R5
     237 003120 000207                  	return
     238                                
     239 003122    231     167     252  Color:	.BYTE 231,167,252,273
         003125    273                  
     240                                
     241 003126    077     076     076  Tabl:	.BYTE 63.,62.,62.,61.,60.,58.,56.,54.,52.,50.,48.,45.,42.,39.,37.,33.
         003131    075     074     072  
         003134    070     066     064  
         003137    062     060     055  
         003142    052     047     045  
         003145    041                  
     242 003146    037     034     031  	.BYTE 31.,28.,25.,22.,19.,17.,14.,12.,10.,8.,6.,4.,3.,2.,2.,1.
         003151    026     023     021  
         003154    016     014     012  
         003157    010     006     004  
         003162    003     002     002  
         003165    001                  
     243                                
     244                                	.end Start
     244                                
