       1                                	.title	CPU
       2                                	.enabl	LC
       3                                	.asect
       4 002000                         	.=2000
       5                                
       6 004000                         C_RAM_BANKS11 = ^B0000100000000000
       7 006000                         C_RAM_BANKS14 = ^B0000110000000000
       8 004400                         C_RAM_BANKS15 = ^B0000100100000000
       9 007400                         C_RAM_BANKS16 = ^B0000111100000000
      10 044400                         C_RAM_BANKS45 = ^B0100100100000000
      11 007400                         C_RAM_BANKS16 = ^B0000111100000000
      12 017400                         C_RAM_BANKS56 = ^B0001111100000000
      13                                
      14 000006                         C_RAM_0 = ^B110
      15 000000                         C_RAM_1 = ^B000
      16 000002                         C_RAM_2 = ^B010
      17 000003                         C_RAM_3 = ^B011
      18 000004                         C_RAM_4 = ^B100
      19 000001                         C_RAM_5 = ^B001
      20 000007                         C_RAM_6 = ^B111
      21 000005                         C_RAM_7 = ^B101
      22                                
      23 000061                         C_KEY_1		= 61
      24 000062                         C_KEY_2		= 62
      25 000063                         C_KEY_3		= 63
      26 000064                         C_KEY_4		= 64
      27 000032                         C_KEY_UP	= 32
      28 000033                         C_KEY_DOWN	= 33
      29 000010                         C_KEY_LEFT	= 10
      30 000031                         C_KEY_RIGHT	= 31
      31 000040                         C_KEY_SPACE	= 40
      32                                
      33 100000                         C_VADDR  = 100000
      34 000100                         C_SCRWID = 64.
      35                                
      36 002000 106427  000200          Start:	mtps	#200
      37 002004 012706  001000          	mov	#1000, SP
      38 002010 010637  000004          	mov	SP, @#4
      39                                
      40 002014 012737  004400  177716  	mov	#C_RAM_BANKS15, @#177716
      41 002022 005037  177662          	clr	@#177662
      42 002026 012737  001330  177664  	mov	#1330, @#177664
      43 002034 004767  002354'         	call	ClearScreen
      44                                
      45 002040 012737  002210  000060  	mov	#KbdInt, @#60
      46 002046 005037  000062          	clr	@#62
      47 002052 012737  002212  000274  	mov	#Kbd274, @#274
      48 002060 042737  000100  177660  	bic	#^B01000000, @#177660
      49                                
      50 002066 012737  002106  000100  	mov	#VsyInt, @#100
      51 002074 005037  000102          	clr	@#102
      52                                
      53 002100 106427  000000          	mtps	#0
      54 002104 000777                  	br	.
      55                                
      56 002110                         VsyCnt = VsyInt+2
      57                                
      58 002106 005227  000000          VsyInt:	inc	#000000
      59 002112 026727  002110' 000012  	cmp	VsyCnt, #10.
      60 002120 103432                  	blo	99$
      61 002122 005067  002110'         	clr	VsyCnt
      62 002126 010046                  	mov	R0, -(SP)
      63 002130 012700  177777          	mov	#177777, R0
      64 002134 163700  177710          	sub	@#177710, R0
      65 002140 012737  177777  177706  	mov	#177777, @#177706
      66 002146 012737  000020  177712  	mov	#20, @#177712
      67 002154 010146                  	mov	R1, -(SP)
      68 002156 010246                  	mov	R2, -(SP)
      69 002160 010346                  	mov	R3, -(SP)
      70 002162 010446                  	mov	R4, -(SP)
      71 002164 010546                  	mov	R5, -(SP)
      72 002166 004767  002222'         	call	PrintTimer
      73 002172 012605                  	mov	(SP)+, R5
      74 002174 012604                  	mov	(SP)+, R4
      75 002176 012603                  	mov	(SP)+, R3
      76 002200 012602                  	mov	(SP)+, R2
      77 002202 012601                  	mov	(SP)+, R1
      78 002204 012600                  	mov	(SP)+, R0
      79 002206 000002                  99$:	rti
      80                                
      81 002210 000002                  KbdInt:	rti
      82 002212 000002                  Kbd274:	rti
      83                                
      84 002214 100000                  CurrentY:	.word	100000
      85 002216 000000                  CurrentX:	.word	0
      86 002220 000000                  CurrentPrev:	.word	0
      87                                
      88                                PrintTimer:
      89 002222 005767  002220'         	tst	CurrentPrev
      90 002226 001416                  	beq	90$
      91 002230 016705  002220'         	mov	CurrentPrev, R5
      92 002234 012704  000006          	mov	#6., R4
      93 002240 012703  000005          10$:	mov	#5., R3
      94 002244 142715  000252          20$:	bicb	#^B10101010, (R5)
      95 002250 062705  000100          	add	#64., R5
      96 002254 077305                  	sob	R3, 20$
      97 002256 162705  000477          	sub	#64.*5.-1, R5
      98 002262 077412                  	sob	R4, 10$
      99 002264 016701  002214'         90$:	mov	CurrentY, R1
     100 002270 066701  002216'         	add	CurrentX, R1
     101 002274 010167  002220'         	mov	R1, CurrentPrev
     102 002300 004767  002522'         	call	PrintOctalWord
     103 002304 062767  000600  002214' 	add	#C_SCRWID*6., CurrentY
     104 002312 026727  002214' 137200  	cmp	CurrentY, #-C_SCRWID*6.+140000
     105 002320 103414                  	blo	99$
     106 002322 012767  100000  002214' 	mov	#100000, CurrentY
     107 002330 062767  000007  002216' 	add	#7., CurrentX
     108 002336 026727  002216' 000071  	cmp	CurrentX, #64.-7.
     109 002344 101402                  	blos	99$
     110 002346 005067  002216'         	clr	CurrentX
     111 002352 000207                  99$:	return
     112                                
     113                                ClearScreen:
     114 002354 012700  100000          	mov	#100000, R0
     115 002360 005001                  	clr	R1
     116 002362 012703  004000          	mov	#4000, R3
     117 002366 010120                  10$:	mov	R1, (R0)+
     118 002370 010120                  	mov	R1, (R0)+
     119 002372 010120                  	mov	R1, (R0)+
     120 002374 010120                  	mov	R1, (R0)+
     121 002376 077305                  	sob	R3, 10$
     122 002400 000207                  	return
     123                                
     124                                SprNumbers45:
     125 002402    077     063     063  	.byte	^B00111111, ^B00110011, ^B00110011, ^B00110011, ^B00111111, 0, 0, 0
         002405    063     077     000  
         002410    000     000          
     126 002412    014     014     014  	.byte	^B00001100, ^B00001100, ^B00001100, ^B00001100, ^B00001100, 0, 0, 0
         002415    014     014     000  
         002420    000     000          
     127 002422    077     060     077  	.byte	^B00111111, ^B00110000, ^B00111111, ^B00000011, ^B00111111, 0, 0, 0
         002425    003     077     000  
         002430    000     000          
     128 002432    077     060     074  	.byte	^B00111111, ^B00110000, ^B00111100, ^B00110000, ^B00111111, 0, 0, 0
         002435    060     077     000  
         002440    000     000          
     129 002442    063     063     077  	.byte	^B00110011, ^B00110011, ^B00111111, ^B00110000, ^B00110000, 0, 0, 0
         002445    060     060     000  
         002450    000     000          
     130 002452    077     003     077  	.byte	^B00111111, ^B00000011, ^B00111111, ^B00110000, ^B00111111, 0, 0, 0
         002455    060     077     000  
         002460    000     000          
     131 002462    077     003     077  	.byte	^B00111111, ^B00000011, ^B00111111, ^B00110011, ^B00111111, 0, 0, 0
         002465    063     077     000  
         002470    000     000          
     132 002472    077     060     060  	.byte	^B00111111, ^B00110000, ^B00110000, ^B00110000, ^B00110000, 0, 0, 0
         002475    060     060     000  
         002500    000     000          
     133 002502    077     063     077  	.byte	^B00111111, ^B00110011, ^B00111111, ^B00110011, ^B00111111, 0, 0, 0
         002505    063     077     000  
         002510    000     000          
     134 002512    077     063     077  	.byte	^B00111111, ^B00110011, ^B00111111, ^B00110000, ^B00111111, 0, 0, 0
         002515    060     077     000  
         002520    000     000          
     135                                
     136                                PrintOctalWord:
     137 002522 012702  000100          	mov	#C_SCRWID, R2
     138 002526 012703  000006          	mov	#6., R3
     139 002532 005005                  	clr	R5
     140 002534 000405                  	br	22$
     141                                20$:
     142 002536 005005                  	clr	R5
     143 002540 006300                  	asl	R0
     144 002542 006105                  	rol	R5
     145 002544 006300                  	asl	R0
     146 002546 006105                  	rol	R5
     147 002550 006300                  22$:	asl	R0
     148 002552 006105                  	rol	R5
     149 002554 006305                  	asl	R5
     150 002556 006305                  	asl	R5
     151 002560 006305                  	asl	R5
     152 002562 062705  002402          	add	#SprNumbers45, R5
     153 002566 112511                  	movb	(R5)+, (R1)
     154 002570 060201                  	add	R2, R1
     155 002572 112511                  	movb	(R5)+, (R1)
     156 002574 060201                  	add	R2, R1
     157 002576 112511                  	movb	(R5)+, (R1)
     158 002600 060201                  	add	R2, R1
     159 002602 112511                  	movb	(R5)+, (R1)
     160 002604 060201                  	add	R2, R1
     161 002606 112511                  	movb	(R5)+, (R1)
     162 002610 162701  000377          	sub	#C_SCRWID*4-1, R1
     163 002614 077330                  	sob	R3, 20$
     164 002616 000207                  	return
     165                                
     166                                	.end Start
     166                                
